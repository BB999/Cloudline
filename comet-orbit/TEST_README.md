# Comet Orbit Simulation - Testing Guide

## テスト概要

このディレクトリには彗星軌道シミュレーションのテストファイルが含まれています。

## テストファイル

### 1. `test.html` (ブラウザベーステスト)
ブラウザで開いて実行できる自動テストスイート。

**実行方法:**
```bash
# ローカルサーバーで実行（例：Python）
python3 -m http.server 8000
# ブラウザで http://localhost:8000/comet-orbit/test.html を開く
```

**テスト内容:**
- Three.jsライブラリの読み込み確認
- 軌道計算の数学的正確性
- 離心率の妥当性
- ケプラーの第二法則（速度変化）の検証
- シェーダーの安全性（NaN回避）
- 設定値の範囲チェック

### 2. `test.js` (Node.jsテスト)
Node.js環境で実行できる軌道計算のユニットテスト。

**実行方法:**
```bash
node comet-orbit/test.js
```

**テスト内容:**
- 楕円軌道の数学的計算
- 焦点距離の計算
- 速度係数の変化
- 星空生成の境界チェック
- シェーダーのフレネル計算の安全性

## 手動テストチェックリスト

ブラウザで `index.html` を開いて、以下を確認してください：

### ビジュアル確認
- [ ] 太陽が中心に表示され、コロナ効果が見える
- [ ] 彗星が楕円軌道上を移動している
- [ ] 彗星の尾が本体の後ろに伸びている
- [ ] 背景に星空が表示されている
- [ ] アニメーションがスムーズ（ちらつきやNaNアーティファクトがない）

### インタラクション確認
- [ ] マウスドラッグでカメラを回転できる
- [ ] タッチドラッグでカメラを回転できる（モバイル）
- [ ] マウススクロールでズームイン/アウトできる
- [ ] ピンチジェスチャーでズームできる（モバイル）
- [ ] カメラの最小距離制限が機能している
- [ ] カメラの最大距離制限が機能している

### レスポンシブ確認
- [ ] ウィンドウサイズを変更しても表示が崩れない
- [ ] モバイルデバイスで正しく表示される
- [ ] オーバーレイテキストが読みやすい

### パフォーマンス確認
- [ ] フレームレートが安定している（60fps目標）
- [ ] CPU使用率が合理的な範囲内
- [ ] メモリリークがない（長時間実行しても問題ない）

## ブラウザ互換性

テスト済み環境：
- Chrome/Edge (推奨)
- Firefox
- Safari

必要な機能：
- WebGL 2.0サポート
- ES6モジュールサポート
- RequestAnimationFrameサポート

## 既知の問題と修正

### 修正済み (commit 9073be2)
1. ✅ シェーダーのNaN問題を修正（フレネル計算のクランプ）
2. ✅ パフォーマンス問題を修正（material.needsUpdate削除）
3. ✅ テールの消失問題を修正（frustumCulled = false）

## テスト結果の報告

問題を発見した場合は、以下の情報を含めて報告してください：

1. ブラウザとバージョン
2. OS
3. 発生した問題の詳細
4. 再現手順
5. スクリーンショット（可能な場合）

## 今後のテスト改善

- [ ] Puppeteerを使った自動ブラウザテスト
- [ ] ビジュアルリグレッションテスト
- [ ] パフォーマンスベンチマーク
- [ ] クロスブラウザ自動テスト
- [ ] アクセシビリティテスト
